CREATE OR REPLACE VIEW toptags AS select row_number() OVER (order by count(*) DESC) as position, taginfo_id, taginfo.name, count(*) as popularity from tags join taginfo on taginfo_id = taginfo.id group by taginfo_id, taginfo.name order by popularity DESC;
-- CREATE OR REPLACE view moods_general as select tabla_like.moosics_id, tabla_like.moods_id, tabla_like.name, tabla_like.votos_like, tabla_dislike.votos_dislike from (select moods_id, moodinfo.name, moods.moosics_id, count(vote) as votos_like from mood_votes join moods on moods.id = mood_votess.moods_id join moodinfo on moodinfo.id = moods.moodinfo_id group by moods_id, vote, moods.moosics_id, moodinfo.name having vote = 'like' order by votos_like DESC) as tabla_like join (select moods_id, moodinfo.name, moods.moosics_id, count(vote) as votos_dislike from mood_votes join moods on moods.id = mood_votes.moods_id join moodinfo on moodinfo.id = moods.moodinfo_id group by moods_id, vote, moods.moosics_id, moodinfo.name having vote = 'zero' order by votos_dislike DESC) as tabla_dislike on tabla_like.moods_id = tabla_dislike.moods_id;
-- CREATE or REPLACE view baby_tracks as select distinct(moosics_id), age(moosics.dumpdate) < INTERVAL '7 day' AS validated from tag_votes join tags on tags_id = id join moosics on tags.moosics_id = moosics.id group by tag_votes.id_tags, tags.moosics_id, validated having count(*) < 3;
-- GRANT SELECT ON top_tags, moods_general, baby_tracks to admin_moosic ;
-- GRANT INSERT ON top_tags, moods_general, baby_tracks to admin_moosic ;
-- GRANT DELETE ON top_tags, moods_general, baby_tracks to admin_moosic ;
-- GRANT UPDATE ON top_tags, moods_general, baby_tracks to admin_moosic ;
